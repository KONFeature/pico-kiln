<!DOCTYPE html>
<html>
<head>
<title>Pico Kiln</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body>
<h1>Pico Kiln Controller</h1>

<h2>SSR: <span id="status">--</span></h2>
<p>Current: <span id="current_temp">--</span>C | Target: <span id="target_temp">--</span>C | State: <span id="state">--</span></p>
<p>Program: <span id="program">--</span></p>

<h2>Profiles</h2>
{profiles_list}

<h2>Controls</h2>
<button onclick="location.reload()">Refresh</button>
<button onclick="stopProgram()">Stop Program</button>
<button onclick="emergencyShutdown()">Emergency Shutdown</button>
<br><br>
<button onclick="location.href='/tuning'">PID Tuning</button>

<hr>
<p><small>
<a href="/api/status">API Status</a> |
<a href="/api/state">API State</a> |
<a href="/api/info">API Info</a>
</small></p>

<script>
// Injected data from server (single JSON replacement)
const data = {DATA};

// Populate status fields on page load
document.getElementById('status').textContent = data.status;
document.getElementById('current_temp').textContent = data.current_temp.toFixed(1);
document.getElementById('target_temp').textContent = data.target_temp.toFixed(1);
document.getElementById('program').textContent = data.program;
document.getElementById('state').textContent = data.state;

function startProfile(profileName) {
if (confirm('Start: ' + profileName + '?')) {
fetch('/api/run', {
method: 'POST',
headers: {'Content-Type': 'application/json'},
body: JSON.stringify({profile: profileName})
})
.then(r => r.json())
.then(d => {
alert(d.success ? 'Started: ' + profileName : 'Error: ' + d.error);
location.reload();
})
.catch(e => alert('Failed: ' + e));
}
}

function stopProgram() {
if (confirm('Stop current program?')) {
fetch('/api/stop', {method: 'POST'})
.then(r => r.json())
.then(d => {
alert(d.success ? 'Stopped' : 'Error: ' + d.error);
location.reload();
})
.catch(e => alert('Failed: ' + e));
}
}

function emergencyShutdown() {
if (confirm('EMERGENCY SHUTDOWN?')) {
fetch('/api/shutdown', {method: 'POST'})
.then(r => r.json())
.then(d => {
alert(d.message);
location.reload();
})
.catch(e => alert('Failed: ' + e));
}
}

setTimeout(() => location.reload(), 5000);
</script>
</body>
</html>
